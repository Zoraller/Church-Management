<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Dashboard</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">

<style>
/* --------------------- CSS Variables --------------------- */
:root {
  /* Standardized sidebar width */
  --sidebar-width: 250px;
  /* Colors */
  --primary-dark: #343a40;
  --secondary-dark: #4b4f53;
  --accent-color: #ffc107; /* Yellow/Warning */
  --light-bg: #f8f9fa;
}

body {
  background: var(--light-bg);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Slightly modern font stack */
  margin: 0;
  padding: 0;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden; /* Prevent horizontal scrolling */
}

/* --------------------- Sidebar & Navigation --------------------- */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: var(--sidebar-width);
  background: linear-gradient(180deg, var(--secondary-dark), var(--primary-dark));
  color: #fff;
  padding-top: 18px;
  overflow-y: auto;
  box-shadow: 4px 0 12px rgba(0, 0, 0, 0.1); /* Slightly stronger shadow */
  z-index: 1100;
  transition: transform 0.28s ease;
}

.sidebar.hidden {
  transform: translateX(calc(-1 * var(--sidebar-width) - 10px)); /* Use variable for translation */
}

.sidebar .sidebar-logo {
  display: block;
  margin: 0 auto 15px;
  max-width: 110px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  padding: 6px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.sidebar hr {
  border-color: rgba(255, 255, 255, 0.1);
  margin: 12px 16px;
}

.sidebar a {
  display: block;
  padding: 10px 18px;
  margin: 6px 8px;
  color: #fff;
  text-decoration: none;
  border-radius: 8px;
  transition: background 0.15s, transform 0.15s;
}

.sidebar a:hover {
  background: rgba(255, 255, 255, 0.08);
  transform: translateX(3px); /* Slightly reduced move for subtle effect */
}

.sidebar a.active {
  background: rgba(255, 255, 255, 0.12);
  font-weight: 700;
  border-left: 4px solid var(--accent-color);
  padding-left: 14px;
}

/* --------------------- Main Content --------------------- */
.main-content {
  margin-left: var(--sidebar-width);
  padding: 25px; /* Increased padding slightly */
  transition: margin-left 0.28s ease;
}

@media (max-width: 768px) {
  .main-content {
    margin-left: 0;
    padding: 18px;
  }
}

/* --------------------- Right Panel (Desktop Events) --------------------- */
.right-panel {
  position: fixed;
  top: 0; /* Align to top */
  right: 0;
  width: 300px;
  height: 100vh; /* Use full height */
  background: #fff;
  box-shadow: -4px 0 12px rgba(0,0,0,0.06);
  overflow-y: auto;
  border-left: 1px solid #ddd;
  z-index: 1050;
  transition: transform 0.3s ease;
  padding-top: 20px; /* Space for the top profile/time area */
}

@media (max-width: 992px) { /* Changed breakpoint for right panel visibility */
  .right-panel {
    display: none;
  }
  .main-content {
    /* Ensure main content doesn't use right margin on tablets/mobiles */
    margin-right: 0 !important;
  }
}

/* --------------------- Cards & Widgets --------------------- */
.card.box-card {
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08); /* Unified, stronger shadow */
  border: none; /* Remove default border */
  transition: transform 0.2s;
}
.card.box-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.card.box-card h5 {
  font-weight: 700;
}

.time-card {
  display: inline-flex; /* Use flex for centering if needed */
  align-items: center;
  padding: 8px 12px;
  font-size: 0.85rem;
  font-weight: 700;
  color: #fff;
  background: var(--secondary-dark); /* Use darker color for time */
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.profile-icon {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--accent-color); /* Highlight border */
  cursor: pointer;
}

.event-card {
  padding: 12px 0;
  border-bottom: 1px solid #eee;
  display: block;
  color: inherit;
  text-decoration: none;
  transition: background 0.1s;
}

.event-card:last-child {
  border-bottom: none;
}

.event-card:hover {
  background-color: var(--light-bg);
  transform: none;
  box-shadow: none;
}

.events-mobile-panel {
  position: fixed;
  bottom: -100%; /* Changed from -110% to -100% for smoother exit */
  left: 0;
  width: 100%;
  height: 75vh; /* Slightly taller */
  background: #fff;
  border-radius: 16px 16px 0 0;
  box-shadow: 0 -8px 30px rgba(0, 0, 0, 0.2);
  transition: bottom 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Added spring effect */
  overflow-y: auto;
  padding: 16px;
  z-index: 1300;
}

.events-mobile-panel.show {
  bottom: 0;
}
.open-events-btn {
  padding: 12px 18px;
  font-size: 1rem;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
}

.hamburger {
  font-size: 1.5rem;
  top: 18px;
  left: 18px;
  padding: 10px;
  border-radius: 50%; /* Circular hamburger button */
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border: none;
}

.small-muted {
  font-size: 0.85rem;
  color: #777; /* Slightly darker muted color */
}

@media (max-width: 768px) {
  /* General tightening of padding on mobile */
  .box-card {
    padding: 10px !important;
  }

  .card-body {
    padding: 8px !important;
  }
}
</style>
</head>
<body>

<!-- BACKDROP for mobile overlay -->
<div id="backdrop" class="backdrop" aria-hidden="true"></div>

<!-- HAMBURGER (mobile) -->
<button id="hamburger" class="hamburger" aria-label="Open menu"><i class="fa-solid fa-bars"></i></button>

<!-- SIDEBAR -->
<nav id="sidebar" class="sidebar" role="navigation" aria-label="Main menu">
  <img src="{{ url_for('static', filename='images/cross-background.jpg') }}" class="sidebar-logo" alt="Logo">
  <hr>
  <a href="{{ url_for('admin_dashboard') }}"><i class="fa-solid fa-house me-2"></i> Dashboard</a>

  <a class="collapsed" data-bs-toggle="collapse" href="#membersDropdown" role="button" aria-expanded="false">
    <i class="fa-solid fa-users me-2"></i> Members <i class="fa-solid fa-chevron-down float-end"></i>
  </a>
  <div class="collapse" id="membersDropdown">
    <a href="{{ url_for('add_members') }}" class="ps-4 d-block"><i class="fa-solid fa-user-plus me-2"></i> Add Member</a>
    <a href="{{ url_for('view_members') }}" class="ps-4 d-block"><i class="fa-solid fa-table me-2"></i> View Members</a>
  </div>

  <a class="collapsed" data-bs-toggle="collapse" href="#ministriesDropdown" role="button" aria-expanded="false">
    <i class="fa-solid fa-church me-2"></i> Ministries <i class="fa-solid fa-chevron-down float-end"></i>
  </a>
  <div class="collapse" id="ministriesDropdown">
    <a href="{{ url_for('add_ministry') }}" class="ps-4 d-block"><i class="fa-solid fa-plus me-2"></i> Add Ministry</a>
    <a href="{{ url_for('admin_ministries') }}" class="ps-4 d-block"><i class="fa-solid fa-list me-2"></i> View Ministries</a>
  </div>

  <a class="collapsed" data-bs-toggle="collapse" href="#lifegroupsDropdown" role="button" aria-expanded="false">
    <i class="fa-solid fa-people-group me-2"></i> Life Groups <i class="fa-solid fa-chevron-down float-end"></i>
  </a>
  <div class="collapse" id="lifegroupsDropdown">
    <a href="{{ url_for('add_lifegroup') }}" class="ps-4 d-block"><i class="fa-solid fa-plus me-2"></i> Add LifeGroup</a>
    <a href="{{ url_for('admin_lifegroups') }}" class="ps-4 d-block"><i class="fa-solid fa-list me-2"></i> View Life Groups</a>
  </div>

  <a class="collapsed" data-bs-toggle="collapse" href="#tithesDropdown" role="button" aria-expanded="false">
    <i class="fa-solid fa-hand-holding-dollar me-2"></i> Tithes & Expenses <i class="fa-solid fa-chevron-down float-end"></i>
  </a>
  <div class="collapse" id="tithesDropdown">
    <a href="{{ url_for('add_tithe') }}" class="ps-4 d-block"><i class="fa-solid fa-plus me-2"></i> Add Tithe</a>
    <a href="{{ url_for('view_tithes') }}" class="ps-4 d-block"><i class="fa-solid fa-table me-2"></i> View Tithes</a>
    <a href="{{ url_for('add_expense') }}" class="ps-4 d-block"><i class="fa-solid fa-circle-plus me-2"></i> Add Expense</a>
    <a href="{{ url_for('view_expenses') }}" class="ps-4 d-block"><i class="fa-solid fa-list me-2"></i> View Expenses</a>
  </div>

  <a class="collapsed" data-bs-toggle="collapse" href="#eventsDropdown" role="button" aria-expanded="false">
    <i class="fa-solid fa-calendar-days me-2"></i> Events <i class="fa-solid fa-chevron-down float-end"></i>
  </a>
  <div class="collapse" id="eventsDropdown">
    <a href="{{ url_for('add_event') }}" class="ps-4 d-block"><i class="fa-solid fa-plus me-2"></i> Add Event</a>
    <a href="{{ url_for('view_events') }}" class="ps-4 d-block"><i class="fa-solid fa-list me-2"></i> View Events</a>
  </div>

  <a class="collapsed" data-bs-toggle="collapse" href="#usersDropdown" role="button" aria-expanded="false">
    <i class="fa-solid fa-user me-2"></i> Users <i class="fa-solid fa-chevron-down float-end"></i>
  </a>
  <div class="collapse" id="usersDropdown">
    <a href="{{ url_for('add_user') }}" class="ps-4 d-block"><i class="fa-solid fa-user-plus me-2"></i> Add User</a>
    <a href="{{ url_for('view_users') }}" class="ps-4 d-block"><i class="fa-solid fa-table me-2"></i> All Users</a>
  </div>
</nav>

<!-- RIGHT PANEL (desktop events) -->
<aside id="rightPanel" class="right-panel" aria-label="Events">
  <div class="card shadow-sm mb-3" style="max-width: 100%; margin: 12px;">
    <div class="card-header bg-primary text-white fw-bold">
      <i class="fa-solid fa-calendar-days me-2"></i> Events
    </div>

    <div class="p-2">
      <input id="eventSearch" class="form-control form-control-sm" placeholder="Search events...">
    </div>

    <ul class="nav nav-tabs nav-fill small px-2" id="eventTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" type="button">Upcoming</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" type="button">Past</button>
      </li>
    </ul>

    <div class="card-body p-2" style="max-height:60vh; overflow-y:auto;">
      <div class="tab-content" id="eventTabsContent">
        <div class="tab-pane fade show active" id="upcoming">
          {% if upcoming_events %}
            {% for event in upcoming_events %}
              <a class="event-card" href="{{ url_for('event_detail', event_id=event.event_id) }}">
                <div class="small fw-bold text-primary">{{ event.event_name }}</div>
                <div class="small-muted"><i class="fa-solid fa-calendar me-1"></i>{{ event.event_date }} • <i class="fa-solid fa-clock me-1"></i>{{ event.event_time_formatted }}</div>
                <div class="small text-muted">{{ event.location }}</div>
              </a>
            {% endfor %}
          {% else %}
            <p class="small-muted text-center">No upcoming events</p>
          {% endif %}
        </div>

        <div class="tab-pane fade" id="past">
          {% if past_events %}
            {% for event in past_events %}
              <a class="event-card" href="{{ url_for('event_detail', event_id=event.event_id) }}">
                <div class="small fw-semibold text-secondary">{{ event.event_name }}</div>
                <div class="small-muted"><i class="fa-solid fa-calendar me-1"></i>{{ event.event_date }}</div>
              </a>
            {% endfor %}
          {% else %}
            <p class="small-muted text-center">No past events</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</aside>

<!-- MOBILE EVENTS PANEL -->
<div id="mobileEventsPanel" class="events-mobile-panel" aria-hidden="true">
  <button id="closeEventsPanel" class="btn btn-sm btn-light mb-2" style="float:right;">Close</button>
  <input id="eventSearchMobile" class="form-control form-control-sm mb-2" placeholder="Search events...">
  <div id="mobileEventsList">
    {% for event in upcoming_events %}
      <a class="text-decoration-none" href="{{ url_for('event_detail', event_id=event.event_id) }}">
        <div class="card event-card mb-1 small">
          <div class="card-body p-2">
            <div class="fw-bold text-primary">{{ event.event_name }}</div>
            <div class="small-muted"><i class="fa-solid fa-calendar me-1"></i>{{ event.event_date }} • <i class="fa-solid fa-clock me-1"></i>{{ event.event_time_formatted }}</div>
            <div class="small text-muted">{{ event.location }}</div>
          </div>
        </div>
      </a>
    {% endfor %}
  </div>
</div>

<!-- Mobile open events button -->
<button id="mobileEventsBtn" class="btn btn-dark open-events-btn"><i class="fa-solid fa-calendar-days me-1"></i> Events</button>

<!-- MAIN CONTENT -->
<main class="main-content" role="main">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div id="datetime" class="time-card"></div>

    <div style="position:relative; z-index:1400;">
      <a id="profileDropdown" class="dropdown-toggle" data-bs-toggle="dropdown" href="#" aria-expanded="false">
        <img src="{{ url_for('uploaded_file', filename=profile_pic) }}" class="profile-icon" alt="Profile" onerror="this.src='{{ url_for('static', filename='images/default-profile.png') }}'">
      </a>
      <ul class="dropdown-menu dropdown-menu-end">
        <li><a class="dropdown-item" href="{{ url_for('update_profile') }}"><i class="fa-solid fa-user me-2"></i> Update Profile</a></li>
        <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="fa-solid fa-right-from-bracket me-2"></i> Logout</a></li>
      </ul>
    </div>
  </div>

  <div class="row text-center mb-4">
    <div class="col-md-4 mb-3">
      <a href="{{ url_for('view_members') }}" class="text-decoration-none">
        <div class="card box-card p-3">
          <h5 class="fw-bold text-primary"><i class="fa-solid fa-users me-2"></i>Members</h5>
          <p class="mb-0">Total: {{ total_members }}</p>
        </div>
      </a>
    </div>
    <div class="col-md-4 mb-3">
      <a href="{{ url_for('admin_ministries') }}" class="text-decoration-none">
        <div class="card box-card p-3">
          <h5 class="fw-bold text-primary"><i class="fa-solid fa-church me-2"></i>Ministries</h5>
          <p class="mb-0">Total: {{ total_ministries }}</p>
        </div>
      </a>
    </div>
    <div class="col-md-4 mb-3">
      <a href="{{ url_for('admin_lifegroups') }}" class="text-decoration-none">
        <div class="card box-card p-3">
          <h5 class="fw-bold text-primary"><i class="fa-solid fa-people-group me-2"></i>Life Groups</h5>
          <p class="mb-0">Total: {{ total_lifegroups }}</p>
        </div>
      </a>
    </div>
  </div>

  <div id="calendar" class="mb-4"></div>

  <div class="row mb-4 justify-content-center">
    <div class="col-md-5 mb-3">
      <div class="card p-3 text-center box-card">
        <h5 class="fw-bold text-success"><i class="fa-solid fa-hand-holding-dollar me-2"></i> Tithes</h5>
        <form method="get" action="{{ url_for('view_tithes') }}" class="d-flex gap-2 justify-content-center align-items-center flex-wrap">
          <select id="filterTypeTithes" name="filter_type" class="form-select form-select-sm w-auto" onchange="toggleInput('Tithes')">
            <option value="day_month" selected>By Day / Month</option>
            <option value="year">By Year</option>
          </select>
          <input type="date" id="dateInputTithes" name="date" class="form-control form-control-sm w-auto">
          <input type="month" id="monthInputTithes" name="month" class="form-control form-control-sm w-auto d-none">
          <input type="number" id="yearInputTithes" name="year" min="2000" max="2100" placeholder="Year" class="form-control form-control-sm w-auto d-none">
          <button class="btn btn-primary btn-sm">View</button>
        </form>
        <p class="mt-3 mb-0">Total: ₱{{ total_tithes }}</p>
      </div>
    </div>

    <div class="col-md-5 mb-3">
      <div class="card p-3 text-center box-card">
        <h5 class="fw-bold text-danger"><i class="fa-solid fa-money-bill-wave me-2"></i> Expenses</h5>
        <form method="get" action="{{ url_for('view_expenses') }}" class="d-flex gap-2 justify-content-center align-items-center flex-wrap">
          <select id="filterTypeExpenses" name="filter_type" class="form-select form-select-sm w-auto" onchange="toggleInput('Expenses')">
            <option value="day_month" selected>By Day / Month</option>
            <option value="year">By Year</option>
          </select>
          <input type="date" id="dateInputExpenses" name="date" class="form-control form-control-sm w-auto">
          <input type="month" id="monthInputExpenses" name="month" class="form-control form-control-sm w-auto d-none">
          <input type="number" id="yearInputExpenses" name="year" min="2000" max="2100" placeholder="Year" class="form-control form-control-sm w-auto d-none">
          <button class="btn btn-primary btn-sm">View</button>
        </form>
        <p class="mt-3 mb-0">Total: ₱{{ total_expenses }}</p>
      </div>
    </div>
  </div>
<!-- Main content -->
<div class="main-content">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div id="datetime" class="time-card"></div>
    <div class="dropdown position-fixed top-0 end-0 p-2" style="z-index: 1050;">
      <a class="d-block" href="#" role="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
        <img src="{{ url_for('uploaded_file', filename=profile_pic) }}" class="profile-icon" onerror="this.src='{{ url_for('static', filename='images/default-profile.png') }}'">
      </a>
      <ul class="dropdown-menu dropdown-menu-end shadow-sm" aria-labelledby="profileDropdown">
        <li><a class="dropdown-item" href="{{ url_for('update_profile') }}"><i class="fa-solid fa-user me-2"></i> Update Profile</a></li>
        <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="fa-solid fa-right-from-bracket me-2"></i> Logout</a></li>
      </ul>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* ---------- Time updater ---------- */
  const datetimeEl = document.getElementById('datetime');
  if(datetimeEl){
    function updateTime(){
      const now = new Date();
      const date = now.toLocaleDateString('en-US', {month:'2-digit', day:'2-digit', year:'numeric'});
      const time = now.toLocaleTimeString('en-US', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
      datetimeEl.textContent = `${date} ${time}`;
    }
    updateTime();
    setInterval(updateTime, 1000);
  }

  /* ---------- Sidebar toggle (mobile) ---------- */
  const sidebar = document.getElementById('sidebar');
  const hamburger = document.getElementById('hamburger');
  const backdrop = document.getElementById('backdrop');

  if(sidebar && hamburger && backdrop){
    function showSidebar(){ sidebar.classList.remove('hidden'); backdrop.classList.add('show'); }
    function hideSidebar(){ sidebar.classList.add('hidden'); backdrop.classList.remove('show'); }

    // Start hidden on mobile
    if(window.innerWidth <= 768) sidebar.classList.add('hidden');

    hamburger.addEventListener('click', () => {
      sidebar.classList.contains('hidden') ? showSidebar() : hideSidebar();
    });
    backdrop.addEventListener('click', hideSidebar);

    // Close sidebar on link click (mobile)
    sidebar.querySelectorAll('a').forEach(a => {
      a.addEventListener('click', () => { if(window.innerWidth <= 768) hideSidebar(); });
    });

    // Reset sidebar on resize
    window.addEventListener('resize', () => {
      if(window.innerWidth > 768){
        sidebar.classList.remove('hidden');
        backdrop.classList.remove('show');
      } else {
        sidebar.classList.add('hidden');
      }
    });
  }

  /* ---------- Right panel desktop event search ---------- */
  const rightSearch = document.getElementById('eventSearch');
  if(rightSearch){
    rightSearch.addEventListener('input', function(){
      const q = this.value.toLowerCase().trim();
      document.querySelectorAll('.right-panel .event-card').forEach(card => {
        card.style.display = card.textContent.toLowerCase().includes(q) ? '' : 'none';
      });
    });
  }

  /* ---------- Mobile events panel ---------- */
  const mobileBtn = document.getElementById('mobileEventsBtn');
  const mobilePanel = document.getElementById('mobileEventsPanel');
  const closeBtn = document.getElementById('closeEventsPanel');
  const mobileSearch = document.getElementById('eventSearchMobile');

  if(mobileBtn && mobilePanel && closeBtn){
    mobileBtn.addEventListener('click', () => mobilePanel.classList.add('show'));
    closeBtn.addEventListener('click', () => mobilePanel.classList.remove('show'));

    // Close if click outside panel content
    mobilePanel.addEventListener('click', e => {
      if(e.target === mobilePanel) mobilePanel.classList.remove('show');
    });

    // Mobile search
    if(mobileSearch){
      mobileSearch.addEventListener('input', function(){
        const q = this.value.toLowerCase().trim();
        document.querySelectorAll('#mobileEventsList .event-card').forEach(card => {
          card.style.display = card.textContent.toLowerCase().includes(q) ? '' : 'none';
        });
      });
    }
  }

  /* ---------- Tithes / Expenses filter toggle ---------- */
  window.toggleInput = function(type){
    const filter = document.getElementById(`filterType${type}`)?.value || 'day_month';
    const date = document.getElementById(`dateInput${type}`);
    const month = document.getElementById(`monthInput${type}`);
    const year = document.getElementById(`yearInput${type}`);
    if(!date || !month || !year) return;

    date.classList.add('d-none'); month.classList.add('d-none'); year.classList.add('d-none');
    if(filter === 'day_month'){ date.classList.remove('d-none'); month.classList.remove('d-none'); }
    if(filter === 'year'){ year.classList.remove('d-none'); }
  };

  /* ---------- FullCalendar ---------- */
  const calendarEl = document.getElementById('calendar');
  if(calendarEl){
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      height: 'auto',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      events: [
        {% for ev in events %}
        {
          title: "{{ ev.event_name|escape }}",
          start: "{{ ev.event_date }}",
          url: "{{ ev.link if 'link' in ev else '#' }}",
          description: "{{ ev.description|escape }}"
        }{% if not loop.last %},{% endif %}
        {% endfor %}
      ],
      eventClick: function(info){
        if(info.event.url && info.event.url !== '#'){
          window.open(info.event.url, '_blank');
          info.jsEvent.preventDefault();
        }
      }
    });
    calendar.render();
  }

});
</script>
</body>
</html>







