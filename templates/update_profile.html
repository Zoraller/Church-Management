<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Update Profile</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
    body {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        font-family: 'Roboto', sans-serif;
        color: #333;
    }

    /* SIDEBAR */
    .sidebar {
        height: 100vh;
        background: linear-gradient(180deg, #4b4f53 0%, #343a40 100%);
        color: white;
        position: fixed;
        width: 250px;
        padding-top: 20px;
        box-shadow: 2px 0 15px rgba(0,0,0,0.1);
        z-index: 1000;
    }
    .sidebar a {
        color: white;
        display: block;
        padding: 12px 20px;
        text-decoration: none;
        transition: 0.3s ease;
        border-radius: 8px;
        margin: 5px 10px;
    }
    .sidebar a:hover {
        background: rgba(255,255,255,0.2);
        transform: translateX(5px);
    }
    .sidebar-logo {
        max-width: 120px;
        border-radius: 50%;
        padding: 5px;
        background: #343a40;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    /* MAIN CONTENT */
    .main-content {
        margin-left: 250px;
        padding: 30px;
    }

    /* CARD */
    .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        background: linear-gradient(135deg, #ffffff 0%, #f9f9f9 100%);
        padding: 40px;
    }

    /* PROFILE PICTURE */
    .profile-pic {
        width: 130px;
        height: 130px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #007bff;
        cursor: pointer;
    }

    /* SAVE BUTTON */
    .btn-save {
        background: linear-gradient(45deg, #28a745, #20c997);
        border: none;
        color: white;
        font-weight: 500;
        padding: 12px;
        border-radius: 8px;
        transition: 0.3s;
    }
    .btn-save:hover {
        background: linear-gradient(45deg, #20c997, #17a2b8);
        transform: translateY(-2px);
    }

    /* PROFILE DROPDOWN */
    .profile-icon {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        object-fit: cover;
        cursor: pointer;
        border: 2px solid #fff;
    }

    @media (max-width: 768px) {
        .sidebar { width: 100%; height: auto; position: relative; }
        .main-content { margin-left: 0; }
    }

    .hamburger {
    display: none;
    cursor: pointer;
    font-size: 1.5rem;
}
@media (max-width:768px) {
    .hamburger { display: inline-block; }
    .sidebar { transform: translateX(-100%); position: fixed; top:0; left:0; height:100vh; z-index:1050; }
    .sidebar.show { transform: translateX(0); }
    .main-content { margin-left:0; }
}
/* Backdrop */
.backdrop {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.5); z-index:1040;
    opacity:0; visibility:hidden; transition:0.3s;
}
.backdrop.show { opacity:1; visibility:visible; }
</style>
</head>
<body>

<div class="backdrop" id="backdrop"></div>

<!-- Mobile Hamburger -->
<div class="d-md-none p-3">
    <span class="hamburger" id="hamburger"><i class="fa-solid fa-bars fa-lg"></i></span>
</div>
    
<div class="sidebar">
    <div class="text-center mb-4">
        <img src="{{ url_for('static', filename='images/cross-background.jpg') }}" class="sidebar-logo" alt="Church Logo">
    </div>
    <hr>
    <a href="{{ url_for('user_dashboard') }}"><i class="fa-solid fa-house me-2"></i> Dashboard</a>
    <a href="{{ url_for('all_ministries') }}"><i class="fa-solid fa-church me-2"></i> Ministries</a>
    <a href="{{ url_for('all_lifegroups') }}"><i class="fa-solid fa-heart me-2"></i> Life Groups</a>
</div>

<!-- MAIN CONTENT -->
<div class="main-content">

    <div class="card">
        <h3 class="mb-3"><i class="fa-solid fa-user"></i> Update Profile</h3>
        <p class="text-muted">Manage your account information and profile picture</p>

        <!-- FLASH MESSAGES -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <form method="POST" enctype="multipart/form-data">
            <input type="file" name="profile_pic" id="profilePicInput" style="display:none;" onchange="this.form.submit()">

            <!-- PROFILE PICTURE -->
            <div class="text-center mb-4">
                {% if user.get('profile_pic') %}
                <img src="{{ url_for('static', filename='uploads/' + user['profile_pic']) }}"
                     class="profile-pic"
                     onclick="document.getElementById('profilePicInput').click()">
                {% else %}
                <div class="profile-pic" style="background:#ddd;" onclick="document.getElementById('profilePicInput').click()"></div>
                {% endif %}
                <p class="text-muted small mt-2">Click image to change</p>
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Username</label>
                <input type="text" name="username" class="form-control" value="{{ user['username'] }}">
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Email</label>
                <input type="email" name="email" class="form-control" value="{{ user['email'] }}">
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Password</label>
                <input type="text" name="password" class="form-control" placeholder="Enter new password">
            </div>

            <button type="submit" class="btn-save w-100">Save Changes</button>

        </form>

    </div>
</div>

<!-- TOP RIGHT PROFILE DROPDOWN -->
<div class="dropdown position-fixed top-0 end-0 p-2">
    <img src="{{ url_for('uploaded_file', filename=profile_pic) }}"
         class="profile-icon dropdown-toggle"
         data-bs-toggle="dropdown"
         onerror="this.src='{{ url_for('static', filename='images/default-profile.png') }}'">
    
    <ul class="dropdown-menu dropdown-menu-end shadow-sm">
        <li><a class="dropdown-item" href="{{ url_for('update_profile') }}">
            <i class="fa-solid fa-user me-2"></i> Update Profile
        </a></li>
        <li><a class="dropdown-item" href="{{ url_for('logout') }}">
            <i class="fa-solid fa-right-from-bracket me-2"></i> Logout
        </a></li>
    </ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
// Elements
const sidebar = document.getElementById("sidebar");
const backdrop = document.getElementById("backdrop");
const hamburger = document.getElementById("hamburger");

// Toggle sidebar
function toggleSidebar() {
    sidebar.classList.toggle("show");
    backdrop.classList.toggle("show");
}

// Event listeners
hamburger.addEventListener("click", toggleSidebar);
backdrop.addEventListener("click", toggleSidebar);

// Close sidebar on link click (mobile)
sidebar.querySelectorAll("a").forEach(link => {
    link.addEventListener("click", () => {
        if(window.innerWidth <= 768) toggleSidebar();
    });
});
        function updateDateTime() {
  const now = new Date();
  const options = { month:'numeric', day:'numeric', year:'numeric', hour:'2-digit', minute:'2-digit', second:'2-digit' };
  document.getElementById('datetime').innerText = now.toLocaleString('en-US', options);
}
setInterval(updateDateTime, 1000);
updateDateTime();

</script>
</body>
</html>


