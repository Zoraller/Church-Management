<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Management</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { 
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    font-family: 'Arial', sans-serif; 
}

/* Sidebar */
.sidebar { 
    height: 100vh; 
    background: linear-gradient(180deg, #4b4f53ff 0%, #343a40 100%);
    color: white; 
    position: fixed; 
    width: 220px; 
    padding-top: 20px; 
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
}
.sidebar a { 
    color: white; 
    display: block; 
    padding: 10px 20px; 
    text-decoration: none; 
    transition: all 0.3s ease;
}
.sidebar a:hover { background: #495057; transform: translateX(5px); }
.sidebar a.active { background: #6c757d; font-weight: bold; border-left: 4px solid #ffc107; }
.sidebar-logo {
    max-width: 120px;
    border-radius: 50%;
    padding: 5px;
    background: #343a40;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* Main content */
.main-content { 
    margin-left: 220px; 
    padding: 20px; 
}

/* Header, time & profile */
.time-card {
  display: inline-block;
  padding: 6px 12px;
  font-size: 0.8rem;    
  font-weight: bold;
  color: #ffffff;          
  background: #616d79ff;    
  border-radius: 20px;      
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  font-family: 'Arial', sans-serif;
  margin-bottom: 15px;
}
.profile-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.3s ease;
}
.profile-icon:hover { transform: scale(1.1); }

/* Buttons */
.btn-primary {
    background: linear-gradient(45deg, #007bff, #0056b3);
    border: none;
    border-radius: 25px;
    padding: 8px 20px;
    font-weight: bold;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,123,255,0.3); }
.btn-warning { border-radius: 5px; }
.btn-danger { border-radius: 5px; }

/* Table */
.table-container {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    overflow-x: auto;
}
.table th {
    background: #007bff;
    color: white;
    text-align: center;
}
.table td { vertical-align: middle; text-align: center; }
.table-hover tbody tr:hover { background-color: #f1f1f1; }

/* Search + Add button row */
.search-add-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
}
.search-box input {
    border-radius: 25px;
    padding: 6px 15px;
    border: 1px solid #ced4da;
    width: 250px;
    transition: box-shadow 0.3s ease;
}
.search-box input:focus { box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25); }

/* Responsive */
@media (max-width: 768px) {
    .sidebar { width: 100%; height: auto; position: relative; }
    .main-content { margin-left: 0; }
    .search-add-row { flex-direction: column; gap: 10px; }
}
    
 /* Desktop */
@media (min-width: 769px) {
  .sidebar {
    transform: translateX(0);
    position: fixed;
    width: 220px;
  }
  .main-content {
    margin-left: 220px;
  }
  .hamburger { display: none; }
  .backdrop { display: none; }
}

/* Mobile */
@media (max-width: 768px) {
  .hamburger {
    display: block;
    position: fixed;
    top: 15px;
    left: 15px;
    z-index: 1100;
    cursor: pointer;
    font-size: 1.7rem;
    color: #343a40;
  }
  .sidebar {
    width: 250px;
    height: 100vh;
    transform: translateX(-100%);
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1050;
    transition: transform 0.3s ease;
  }
  .sidebar.show { transform: translateX(0); }
  .main-content { margin-left: 0; }
  .backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1040;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  .backdrop.show { opacity: 1; visibility: visible; }
}

</style>
</head>
<body>
  
<div class="backdrop" id="backdrop"></div>

<!-- Mobile Hamburger -->
<div class="d-md-none p-3">
    <span class="hamburger" id="hamburger"><i class="fa-solid fa-bars fa-lg"></i></span>
</div>

<div class="sidebar" id="sidebar">
    <div class="text-center">
        <img src="{{ url_for('static', filename='images/cross-background.jpg') }}" class="sidebar-logo">
    </div>
    <hr>
        <a href="{{ url_for('admin_dashboard') }}"><i class="fa-solid fa-house"></i> Dashboard</a>

  <a class="collapsed" data-bs-toggle="collapse"
  href="#membersDropdown" role="button" aria-expanded="false" aria-controls="membersDropdown">
      <i class="fa-solid fa-users"></i> Members
      <i class="fa-solid fa-chevron-down float-end"></i>
  </a>
  <div class="collapse" id="membersDropdown">
      <a href="{{ url_for('add_members') }}" class="ps-4 d-block"><i class="fa-solid fa-user-plus me-2"></i> Add Member</a>
      <a href="{{ url_for('view_members') }}" class="ps-4 d-block"><i class="fa-solid fa-table me-2"></i> View Members</a>
  </div>

  <a class="collapsed" data-bs-toggle="collapse"
  href="#ministriesDropdown" role="button" aria-expanded="false" aria-controls="ministriesDropdown">
      <i class="fa-solid fa-church"></i> Ministries
      <i class="fa-solid fa-chevron-down float-end"></i>
  </a>
  <div class="collapse" id="ministriesDropdown">
      <a href="{{ url_for('add_ministry') }}" class="ps-4 d-block"><i class="fa-solid fa-plus me-2"></i> Add Ministry</a>
      <a href="{{ url_for('admin_ministries') }}" class="ps-4 d-block"><i class="fa-solid fa-list me-2"></i> View Ministries</a>
  </div>

  <a class="collapsed" data-bs-toggle="collapse"
  href="#lifegroupsDropdown" role="button" aria-expanded="false" aria-controls="lifegroupsDropdown">
      <i class="fa-solid fa-people-group"></i> Life Groups
      <i class="fa-solid fa-chevron-down float-end"></i>
  </a>
  <div class="collapse" id="lifegroupsDropdown">
     <a href="{{ url_for('add_lifegroup') }}" class="ps-4 d-block"><i class="fa-solid fa-plus me-2"></i> Add LifeGroup</a>
      <a href="{{ url_for('admin_lifegroups') }}" class="ps-4 d-block"><i class="fa-solid fa-list me-2"></i> View Life Groups</a>
  </div>

  <a class="collapsed" data-bs-toggle="collapse"
  href="#tithesDropdown" role="button" aria-expanded="false" aria-controls="tithesDropdown">
      <i class="fa-solid fa-hand-holding-dollar"></i> Tithes & Expenses
      <i class="fa-solid fa-chevron-down float-end"></i>
  </a>
  <div class="collapse" id="tithesDropdown">
      <a href="{{ url_for('add_tithe') }}" class="ps-4 d-block"><i class="fa-solid fa-plus me-2"></i> Add Tithe</a>
      <a href="{{ url_for('view_tithes') }}" class="ps-4 d-block"><i class="fa-solid fa-table me-2"></i> View Tithes</a>
      <a href="{{ url_for('add_expense') }}" class="ps-4 d-block"><i class="fa-solid fa-circle-plus me-2"></i> Add Expense</a>
      <a href="{{ url_for('view_expenses') }}" class="ps-4 d-block active"><i class="fa-solid fa-list me-2"></i> View Expenses</a>
  </div>

  <a class="collapsed" data-bs-toggle="collapse"
   href="#eventsDropdown" role="button" aria-expanded="false" aria-controls="eventsDropdown">
  <i class="fa-solid fa-calendar-days"></i> Events
  <i class="fa-solid fa-chevron-down float-end"></i>
</a>
<div class="collapse" id="eventsDropdown">
  <a href="{{ url_for('add_event') }}" class="ps-4 d-block">
    <i class="fa-solid fa-plus me-2"></i> Add Event
  </a>
  <a href="{{ url_for('view_events') }}" class="ps-4 d-block">
    <i class="fa-solid fa-list me-2"></i> View Events
  </a>
</div>

  <a class="collapsed" data-bs-toggle="collapse"
  href="#usersDropdown" role="button" aria-expanded="false">
      <i class="fa-solid fa-user"></i> Users
      <i class="fa-solid fa-chevron-down float-end"></i>
  </a>
  <div class="collapse" id="usersDropdown">
      <a href="{{ url_for('add_user') }}" class="ps-4 d-block"><i class="fa-solid fa-user-plus me-2"></i> Add User</a>
      <a href="{{ url_for('view_users') }}" class="ps-4 d-block"><i class="fa-solid fa-table me-2"></i> All Users</a>
  </div>
</div>

<!-- Main content -->
<div class="main-content">
  <!-- Top: time only -->
  <div id="datetime" class="time-card"></div>

  <!-- Search + Add User -->
  <div class="search-add-row">
      <div class="search-box">
          <input type="text" id="searchInput" placeholder="Search users by username, email or role...">
      </div>
      <a href="{{ url_for('add_user') }}" class="btn btn-primary"><i class="fa-solid fa-user-plus me-2"></i> Add User</a>
  </div>

  <!-- User table -->
  <div class="table-container">
      <table class="table table-bordered table-hover" id="usersTable">
          <thead>
              <tr>
                  <th>Username</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Password</th>
                  <th>Actions</th>
              </tr>
          </thead>
          <tbody>
              {% for user in users %}
              <tr>
                  <td>{{ user.username }}</td>
                  <td>{{ user.email }}</td>
                  <td>{{ user.role }}</td>
                  <td>{{ user.password }}</td>
                  <td>
                      <a href="{{ url_for('edit_user', user_id=user.id) }}" class="btn btn-sm btn-warning"><i class="fa-solid fa-pen-to-square"></i></a>
                      <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" style="display:inline-block;">
                          <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this user?')"><i class="fa-solid fa-trash"></i></button>
                      </form>
                  </td>
              </tr>
              {% endfor %}
          </tbody>
      </table>
  </div>
</div>

<!-- Profile Dropdown -->
<div class="dropdown position-fixed top-0 end-0 p-2">
  <img src="{{ url_for('static', filename='images/iu.jpg') }}" class="profile-icon dropdown-toggle" data-bs-toggle="dropdown" alt="User">
  <ul class="dropdown-menu dropdown-menu-end">
    <li><a class="dropdown-item" href="/logout"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
  </ul>
</div>

<script>
// Update time every second
function updateDateTime() {
    const now = new Date();
    const options = { month:'numeric', day:'numeric', year:'numeric', hour:'2-digit', minute:'2-digit', second:'2-digit' };
    document.getElementById('datetime').innerText = now.toLocaleDateString('en-US', options);
}
setInterval(updateDateTime, 1000);
updateDateTime();

// Search/filter functionality
const searchInput = document.getElementById('searchInput');
searchInput.addEventListener('keyup', function() {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll('#usersTable tbody tr');
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
    });
});


    document.addEventListener('DOMContentLoaded', function() {
    // Elements
    const sidebar = document.getElementById("sidebar");
    const backdrop = document.getElementById("backdrop");
    const hamburger = document.getElementById("hamburger");

    // Toggle sidebar
    function toggleSidebar() {
        sidebar.classList.toggle("show");
        backdrop.classList.toggle("show");
    }

    // Event listeners
    hamburger.addEventListener("click", toggleSidebar);
    backdrop.addEventListener("click", toggleSidebar);

    // Close sidebar on link click (mobile)
    sidebar.querySelectorAll("a").forEach(link => {
        link.addEventListener("click", () => {
            if(window.innerWidth <= 768) toggleSidebar();
        });
    });

    // Make sidebar clickable to close on mobile (clicking on sidebar background, not links)
    sidebar.addEventListener('click', function(e) {
        if (window.innerWidth <= 768 && !e.target.closest('a')) {
            toggleSidebar();
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

