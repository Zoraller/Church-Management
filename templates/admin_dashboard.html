<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* --------------------- General --------------------- */
body {
    background: #f8f9fa;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
}
a { text-decoration: none; color: inherit; }

/* --------------------- Sidebar --------------------- */
.sidebar {
    height: 100vh;
    background: #4b4f53ff;
    color: white;
    position: fixed;
    width: 220px;
    padding-top: 20px;
    overflow-y: auto;
    z-index: 1001;
}
.sidebar a { color: white; display: block; padding: 10px 20px; }
.sidebar a:hover { background: #495057; }
.sidebar-logo {
    max-width: 120px;
    border-radius: 50%;
    padding: 5px;
    background: #343a40;
    display: block;
    margin: 0 auto 10px auto;
}

/* --------------------- Main Content --------------------- */
.main-content {
    margin-left: 220px;
    margin-right: 300px;
    padding: 20px;
}

/* --------------------- Right Panel (Events) --------------------- */
.right-panel {
    position: fixed;
    top: 0;
    right: 0;
    width: 300px;
    height: 100vh;
    background: #f8f9fa;
    z-index: 1000;
    overflow-y: auto;
    box-shadow: -2px 0 5px rgba(0,0,0,0.1);
    padding-top: 60px;
}
.right-panel a { pointer-events: auto; }

/* --------------------- Cards --------------------- */
.card {
    border-radius: 15px;
    transition: all 0.3s ease;
}
.card:hover { transform: translateY(-4px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
.box-card {
    background: #fff; border-radius: 15px; padding: 20px; box-shadow: 0 6px 15px rgba(0,0,0,0.1); height: 100%;
}
.box-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
.box-card h5 { font-weight: bold; }
.box-card p { margin: 0; font-size: 0.95rem; }
.box-card i { color: #007bff; }
.box-card:hover i { color: #0056b3; }

/* --------------------- Event Cards --------------------- */
.event-card {
    display: block;
    width: 100%;
    text-decoration: none;
    color: inherit;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    padding: 10px;
    border-bottom: 1px solid #ddd;
}
.event-card:hover { transform: translateY(-2px); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }

/* --------------------- Time Card --------------------- */
.time-card {
    display: inline-block;
    padding: 6px 12px;
    font-size: 0.7rem;
    font-weight: bold;
    color: #fff;
    background: #616d79ff;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(202, 190, 190, 0.2);
}

/* --------------------- Profile Icon --------------------- */
.profile-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
}

/* --------------------- Scrollbar --------------------- */
.card-body::-webkit-scrollbar { width: 6px; }
.card-body::-webkit-scrollbar-thumb { background-color: rgba(0,0,0,0.2); border-radius: 10px; }

/* --------------------- Colors --------------------- */
.text-success { color: #28a745 !important; }
.text-danger { color: #dc3545 !important; }

/* --------------------- Mobile Responsive --------------------- */
.hamburger { display: none; }
@media (max-width: 768px) {
    .sidebar { transform: translateX(-100%); z-index: 1100; }
    .sidebar.show { transform: translateX(0); }
    .hamburger { display: block; position: fixed; top: 15px; left: 15px; z-index: 1100; cursor: pointer; font-size: 1.7rem; color: #343a40; }
    .main-content { margin-left: 0; margin-right: 0; }

    /* Mobile Events Panel */
    .events-mobile-panel {
        position: fixed;
        bottom: -100%;
        left: 0;
        width: 100%;
        height: 70%;
        background: #f8f9fa;
        border-radius: 15px 15px 0 0;
        box-shadow: 0 -4px 15px rgba(0,0,0,0.2);
        transition: bottom 0.3s ease;
        z-index: 1500;
        overflow-y: auto;
        padding: 15px;
    }
    .events-mobile-panel.show { bottom: 0; }
    .open-events-btn {
        display: block;
        position: fixed;
        bottom: 15px;
        right: 15px;
        background: #343a40;
        color: #fff;
        padding: 12px 18px;
        border-radius: 50px;
        font-size: 0.9rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 1600;
        cursor: pointer;
    }
}
</style>
</head>
<body>

<div class="backdrop" id="backdrop"></div>

<!-- Mobile Hamburger -->
<div class="d-md-none p-3">
    <span class="hamburger" id="hamburger"><i class="fa-solid fa-bars fa-lg"></i></span>
</div>

<!-- Mobile Events Panel -->
<div class="events-mobile-panel" id="mobileEventsPanel">
  <span id="closeEventsPanel" style="position:absolute; top:10px; right:15px; font-size:1.5rem; cursor:pointer;">&times;</span>
  <input type="text" id="eventSearchMobile" class="form-control form-control-sm mb-2" placeholder="Search events...">
  <div id="mobileEventsList">
    {% for event in upcoming_events %}
    <a href="{{ url_for('event_detail', event_id=event.event_id) }}" class="text-decoration-none event-card">
      <div class="card mb-1 border-0 shadow-sm small">
        <div class="card-body p-1">
          <h6 class="fw-bold text-primary mb-1 small">{{ event.event_name }}</h6>
          <p class="text-muted mb-1 small"><i class="fa-solid fa-calendar"></i> {{ event.event_date }}</p>
          <p class="text-muted mb-1 small"><i class="fa-solid fa-clock"></i> {{ event.event_time_formatted }}</p>
          <p class="small text-muted mb-1">{{ event.description }}</p>
          <p class="mb-0 small"><i class="fa-solid fa-location-dot text-danger"></i> {{ event.location }}</p>
        </div>
      </div>
    </a>
    {% endfor %}
  </div>
</div>

<button id="openEventsBtn" class="open-events-btn"><i class="fa-solid fa-calendar-days me-1"></i> Events</button>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <div class="text-center">
    <img src="{{ url_for('static', filename='images/cross-background.jpg') }}" class="sidebar-logo">
  </div>
  <hr>
  <a href="{{ url_for('admin_dashboard') }}"><i class="fa-solid fa-house"></i> Dashboard</a>
  <!-- Add other sidebar links here -->
</div>

<!-- Right Panel Desktop -->
<div class="right-panel" id="rightPanel">
  <div class="card shadow-sm mb-4" style="max-width: 500px;">
    <div class="card-header bg-primary text-white fw-bold">
      <span><i class="fa-solid fa-calendar-days me-2"></i> Events</span>
    </div>
    <div class="p-1">
      <input type="text" id="eventSearch" class="form-control form-control-sm" placeholder="Search events...">
    </div>
    <ul class="nav nav-tabs nav-fill small" id="eventTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" type="button" role="tab" aria-controls="upcoming" aria-selected="true">Upcoming</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" type="button" role="tab" aria-controls="past" aria-selected="false">Past</button>
      </li>
    </ul>
    <div class="card-body p-1" style="max-height: 250px; overflow-y: auto;">
      <div class="tab-content" id="eventTabsContent">
        <div class="tab-pane fade show active" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab">
          {% for event in upcoming_events %}
          <a href="{{ url_for('event_detail', event_id=event.event_id) }}" class="text-decoration-none event-card">
            <div class="card mb-1 border-0 border-top border-primary border-1 shadow-sm small">
              <div class="card-body p-1">
                <h6 class="fw-bold text-primary mb-1 small">{{ event.event_name }}</h6>
                <p class="text-muted mb-1 small"><i class="fa-solid fa-calendar"></i> {{ event.event_date }}</p>
                <p class="text-muted mb-1 small"><i class="fa-solid fa-clock"></i> {{ event.event_time_formatted }}</p>
                <p class="small text-muted mb-1">{{ event.description }}</p>
                <p class="mb-0 small"><i class="fa-solid fa-location-dot text-danger"></i> {{ event.location }}</p>
              </div>
            </div>
          </a>
          {% endfor %}
        </div>
        <div class="tab-pane fade" id="past" role="tabpanel" aria-labelledby="past-tab">
          {% for event in past_events %}
          <a href="{{ url_for('event_detail', event_id=event.event_id) }}" class="text-decoration-none event-card">
            <div class="card mb-1 border-0 border-top border-secondary border-1 shadow-sm small">
              <div class="card-body p-1">
                <h6 class="fw-bold text-secondary mb-1 small">{{ event.event_name }}</h6>
                <p class="text-muted mb-1 small"><i class="fa-solid fa-calendar"></i> {{ event.event_date }}</p>
                <p class="text-muted mb-1 small"><i class="fa-solid fa-clock"></i> {{ event.event_time_formatted }}</p>
                <p class="small text-muted mb-1">{{ event.description }}</p>
                <p class="mb-0 small"><i class="fa-solid fa-location-dot text-danger"></i> {{ event.location }}</p>
              </div>
            </div>
          </a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="main-content">
  <div id="datetime" class="time-card mb-2"></div>
  <div id="calendar" class="mb-4"></div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Date/Time
  function updateDateTime() {
    const now = new Date();
    document.getElementById('datetime').innerText =
      now.toLocaleDateString('en-US') + ' ' + now.toLocaleTimeString('en-US');
  }
  setInterval(updateDateTime, 1000); updateDateTime();

  // Sidebar toggle
  const sidebar = document.getElementById("sidebar");
  const backdrop = document.getElementById("backdrop");
  const hamburger = document.getElementById("hamburger");
  hamburger.addEventListener("click", () => { sidebar.classList.toggle("show"); backdrop.classList.toggle("show"); });
  backdrop.addEventListener("click", () => { sidebar.classList.remove("show"); backdrop.classList.remove("show"); });

  // Mobile Events Panel
  const openEventsBtn = document.getElementById('openEventsBtn');
  const mobileEventsPanel = document.getElementById('mobileEventsPanel');
  const closeEventsPanel = document.getElementById('closeEventsPanel');
  openEventsBtn.addEventListener('click', () => mobileEventsPanel.classList.add('show'));
  closeEventsPanel.addEventListener('click', () => mobileEventsPanel.classList.remove('show'));

  // Event search filter
  const searchInputs = [
    {input: 'eventSearch', container: '.right-panel .event-card'},
    {input: 'eventSearchMobile', container: '#mobileEventsList .event-card'}
  ];
  searchInputs.forEach(({input, container}) => {
    const el = document.getElementById(input);
    if(el) {
      el.addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        document.querySelectorAll(container).forEach(event => {
          event.style.display = event.textContent.toLowerCase().includes(filter) ? '' : 'none';
        });
      });
    }
  });

  // FullCalendar
  const calendarEl = document.getElementById('calendar');
  if(calendarEl) {
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      headerToolbar: {left:'prev,next today',center:'title',right:'dayGridMonth,timeGridWeek,timeGridDay'},
      events: [
        {% for ev in events %}
        {title:"{{ ev.event_name }}", start:"{{ ev.event_date }}", url:"{{ ev.link if 'link' in ev else '#' }}"},
        {% endfor %}
      ],
      eventClick: function(info) {
        if(info.event.url && info.event.url != "#") {
          window.open(info.event.url, "_blank");
          info.jsEvent.preventDefault();
        }
      }
    });
    calendar.render();
  }
});
</script>
</body>
</html>
